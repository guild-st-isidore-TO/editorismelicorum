digraph {
    label = "\nEDITORIS MELICORUM\nSystem data flow diagram\nv3.0";
    node [shape = box;];
    
    editor -> finalDocuments;

    subgraph cluster_00 {
        label = "EDITORIS\nMELICORUM";
        docTitleData -> editor;
        docMusicData -> editor;
        docStructureData -> editor;
        scriptor -> scholasticusTranslators [dir=both, arrowhead=none, arrowtail=odiamond]; 
        lector -> scholasticusTranslators [dir=both, arrowhead=none, arrowtail=odiamond]; 
        
        subgraph cluster_10 {
            label = "LECTOR\nReader";
            lector -> lectorParsers [dir=both, arrowhead=none, arrowtail=diamond]; 
            lector -> lectorCopiers [dir=both, arrowhead=none, arrowtail=diamond]; 
        }
        subgraph cluster_11 {
            label = "SCRIPTOR\nWriter";
            scriptor -> scriptorWriters [dir=both, arrowhead=none, arrowtail=diamond]; 
            scriptor -> scriptorReaders [dir=both, arrowhead=none, arrowtail=diamond]; 
        }
        subgraph cluster_12 {
            label = "SCHOLASTICUS\nScholar";
            scholasticus -> scholasticusTranslators [dir=both, arrowhead=none, arrowtail=diamond]; 
        }
        
        subgraph cluster_20 {
            label = "Input data\n(.gabc and .ly files)";
            gabcSource -> lectorParsers;
            lySource -> lectorParsers;
        }
        
        // gabcParser -> lyTranslation [color = red;];
        
        subgraph cluster_30 {
            label = "Formatted input data\n(.ly files)";
            lectorCopiers -> formattedMusicData;
            lectorCopiers -> formattedStructureData;
            formattedMusicData -> scriptorReaders;
            formattedStructureData -> scriptorReaders;
        }
        subgraph cluster_31 {
            label = "Lilypond document parts\n(.ly files)";
            scriptorWriters -> docTitleData;
            scriptorWriters -> docMusicData;
            scriptorWriters -> docStructureData;
        }
    }
    
    // lyFormatter -> outputHtml [color = blue;];
    // lyFormatter -> outputMarkdown [color = blue;];
    // lyFormatter -> outputPdf [color = blue;];
    // lyFormatter -> outputSvg [color = blue;];
    // lyFormatter -> outputPng [color = blue;];
    
    gabcSource [label = "GABC sources\n(GregoBase, etc)";shape = cylinder;color = blue;];
    lySource [label = "LY sources\n(CMAA, etc)";shape = cylinder;color = blue;];
    
    editor [label = "EDITOR";shape = box3d;color = red;];
    
    lector [label = "LECTOR";shape = box3d;color = red;];
    lectorParsers [label = "Lec. Parsers";shape = component;color = darkorange;];
    lectorCopiers [label = "Lec. Copiers";shape = component;color = darkorange;];
    
    scriptor [label = "SCRIPTOR";shape = box3d;color = red;];
    scriptorReaders [label = "Scr. Readers";shape = component;color = darkorange;];
    scriptorWriters [label = "Scr. Writers";shape = component;color = darkorange;];
    
    scholasticus [label = "SCHOLASTICUS";shape = box3d;color = red;];
    scholasticusTranslators [label = "Sch. Translators";shape = component;color = darkorange;];
    
    formattedMusicData [label = "Music data";shape = note;color = darkgreen;];
    formattedStructureData [label = "Structure data";shape = note;color = darkgreen;];
    
    docTitleData [label = "Title page";shape = note;color = darkgreen;];
    docMusicData [label = "Music data";shape = note;color = darkgreen;];
    docStructureData [label = "Structure data";shape = note;color = darkgreen;];
    
    finalDocuments [label = "Arrangement sheets,\nhymnals, etc.";shape = folder;color = darkgreen;];
}